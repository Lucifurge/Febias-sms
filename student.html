<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Student Dashboard | FEBIAS College of Bible</title>
<script src="https://unpkg.com/@supabase/supabase-js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif}
body{background:#f5f8f6;min-height:100vh;display:flex;flex-direction:column}
header{background:linear-gradient(90deg,#2e7d32,#d4af37);color:white;padding:15px 40px;display:flex;justify-content:space-between;align-items:center}
header h1{font-size:20px;letter-spacing:1px}
header .term{font-size:14px;opacity:.9}
nav{background:#fff;box-shadow:0 3px 8px rgba(0,0,0,.1);display:flex;flex-wrap:wrap;justify-content:space-around;padding:10px;position:sticky;top:0;z-index:100}
nav a{color:#2e7d32;text-decoration:none;font-weight:600;padding:8px 15px;border-radius:8px;transition:.2s}
nav a:hover,nav a.active{background:#2e7d32;color:white}
.main{padding:40px 20px;max-width:900px;margin:0 auto}
.card{background:white;border-radius:15px;padding:25px;box-shadow:0 5px 15px rgba(0,0,0,.1);margin-bottom:25px}
h2{color:#2e7d32;margin-bottom:15px;font-size:20px}
p{color:#444;line-height:1.6}
.footer{text-align:center;padding:15px;font-size:13px;color:#888}
button.logout{background:crimson;color:white;border:none;padding:8px 15px;border-radius:8px;cursor:pointer;transition:.2s}
button.logout:hover{background:darkred}
</style>
</head>
<body>

<header>
  <div>
    <h1>FEBIAS College of Bible</h1>
    <div class="term">2025–2026 | 1st Term</div>
  </div>
  <div id="studentName">Loading...</div>
  <button class="logout" onclick="logout()">Logout</button>
</header>

<nav>
  <a href="#" data-page="home" class="active">Home</a>
  <a href="#" data-page="profile">My Profile</a>
  <a href="#" data-page="fees">My Fees</a>
  <a href="#" data-page="grades">My Grades</a>
  <a href="#" data-page="schedule">My Schedule</a>
  <a href="#" data-page="transcript">My Transcript</a>
  <a href="#" data-page="messages">My Message</a>
  <a href="#" data-page="requests">My Request</a>
  <a href="#" data-page="announcements">Faculty Announcements</a>
  <a href="#" data-page="attendance">My Attendance</a>
  <a href="#" data-page="clearance">My Clearance</a>
  <a href="#" data-page="registration">Registration Form</a>
  <a href="#" data-page="links">DSM External Links</a>
</nav>

<div class="main" id="contentArea">
  <div class="card">
    <h2>Student Home</h2>
    <p><strong>Success!</strong><br>Welcome, you have successfully logged in.</p>
  </div>
</div>

<div class="footer">© 2025 FEBIAS College of Bible</div>

<script>
const supabaseUrl = "https://dlwytowtesllydqsiicv.supabase.co";
const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRsd3l0b3d0ZXNsbHlkcXNpaWN2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjE1NDE3NjcsImV4cCI6MjA3NzExNzc2N30.c1WESi7nCH6MPHgQc68OcFTVZ4OLLsyrh8Kjuf4Av1A";
const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

document.addEventListener("DOMContentLoaded", async () => {
  const user = JSON.parse(localStorage.getItem("user"));
  if (!user || !user.id_number) return (window.location.href = "index.html");
  document.getElementById("studentName").textContent = user.full_name;

  document.querySelectorAll("nav a").forEach(a=>{
    a.addEventListener("click",async e=>{
      e.preventDefault();
      document.querySelectorAll("nav a").forEach(x=>x.classList.remove("active"));
      a.classList.add("active");
      await loadPage(a.dataset.page,user);
    });
  });
});

async function loadPage(page,user){
  const main=document.getElementById("contentArea");
  main.innerHTML=`<div class="card"><h2>Loading...</h2></div>`;
  const id=user.id_number;

  if(page==="home"){main.innerHTML=`<div class="card"><h2>Welcome</h2><p>Hello ${user.full_name}, welcome back!</p></div>`;return;}

  if(page==="profile"){
    const {data:p}=await supabase.from("tblstudent").select("*").eq("stuid",id).maybeSingle();
    main.innerHTML=`<div class="card"><h2>My Profile</h2><p><strong>${p.studentname}</strong><br>ID: ${p.stuid}<br>Email: ${p.studentemail}<br>Program: ${p.program}<br>Address: ${p.address}<br>Contact: ${p.contactnumber}</p></div>`;
    return;
  }

  if(page==="fees"){
    const {data}=await supabase.from("tblfees").select("*").eq("stuid",id);
    main.innerHTML=`<div class="card"><h2>My Fees</h2>${data.map(f=>`<p>${f.term} - ₱${f.amount} (${f.status})</p>`).join("")||"No fees found."}</div>`;
    return;
  }

  if(page==="grades"){
    const {data}=await supabase.from("tblgrades").select("*").eq("stuid",id);
    main.innerHTML=`<div class="card"><h2>My Grades</h2>${data.map(g=>`<p>${g.subject}: <strong>${g.grade}</strong></p>`).join("")||"No grades found."}</div>`;
    return;
  }

  if(page==="schedule"){
    const {data}=await supabase.from("tblschedule").select("*").eq("stuid",id);
    main.innerHTML=`<div class="card"><h2>My Schedule</h2>${data.map(s=>`<p>${s.day} ${s.time} - ${s.subject}</p>`).join("")||"No schedule yet."}</div>`;
    return;
  }

  if(page==="transcript"){
    const {data}=await supabase.from("tbltranscript").select("*").eq("stuid",id);
    main.innerHTML=`<div class="card"><h2>My Transcript</h2>${data.map(t=>`<p>${t.course} (${t.term}): <strong>${t.grade}</strong></p>`).join("")||"No transcript data."}</div>`;
    return;
  }

  if(page==="messages"){
    const {data}=await supabase.from("tblmessages").select("*").eq("stuid",id);
    main.innerHTML=`<div class="card"><h2>My Messages</h2>${data.map(m=>`<p><strong>${m.sender}</strong>: ${m.message}</p>`).join("")||"No messages."}</div>`;
    return;
  }

  if(page==="requests"){
    const {data}=await supabase.from("tblrequests").select("*").eq("stuid",id);
    main.innerHTML=`<div class="card"><h2>My Requests</h2>${data.map(r=>`<p>${r.request_type} - ${r.status}</p>`).join("")||"No requests yet."}</div>`;
    return;
  }

  if(page==="announcements"){
    const {data}=await supabase.from("tblannouncements").select("*");
    main.innerHTML=`<div class="card"><h2>Faculty Announcements</h2>${data.map(a=>`<p><strong>${a.title}</strong><br>${a.content}</p>`).join("")||"No announcements."}</div>`;
    return;
  }

  if(page==="attendance"){
    const {data}=await supabase.from("tblattendance").select("*").eq("stuid",id);
    main.innerHTML=`<div class="card"><h2>My Attendance</h2>${data.map(att=>`<p>${att.date}: ${att.status}</p>`).join("")||"No attendance record."}</div>`;
    return;
  }

  if(page==="clearance"){
    const {data}=await supabase.from("tblclearance").select("*").eq("stuid",id);
    main.innerHTML=`<div class="card"><h2>My Clearance</h2>${data.map(c=>`<p>${c.department}: ${c.status}</p>`).join("")||"No clearance record."}</div>`;
    return;
  }

  if(page==="links"){
    const {data}=await supabase.from("tbllinks").select("*");
    main.innerHTML=`<div class="card"><h2>DSM External Links</h2>${data.map(l=>`<p><a href="${l.url}" target="_blank">${l.name}</a></p>`).join("")||"No links found."}</div>`;
    return;
  }

  main.innerHTML=`<div class="card"><p>Feature under development.</p></div>`;
}

function logout(){
  localStorage.removeItem("user");
  window.location.href="index.html";
}
</script>
</body>
</html>
